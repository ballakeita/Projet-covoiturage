<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <title>Boutique Virtuelle</title>
  <link rel="stylesheet" href="shop.css">
</head>

<body>
  <header class="main-header">
    <!-- Logo -->
    <a href="home.html" class="logo">
      <img src="logo.png" alt="Logo SoraDrive">
      <div class="sora-logo"></div>
    </a>
    <div class="user-stats">
      <div class="stat">‚úí <span id="points-display">Chargement</span></div>
    </div><!-- Ajout -->

    <!-- Recherche -->
    <div class="search-container">
      <input class="search-input" type="text" id="searchInput" placeholder="Rechercher un objet..."
        oninput="filterItems()">
      <button class="btn-search" aria-label="Rechercher">üîç</button>
    </div>

    <!-- Navigation principale -->
    <nav class="main-nav">
      <a href="home.html">Accueil</a>
      <a href="gestionTrajets.html">Trajets</a>
      <a href="./profil.html">Profil</a>
      <a href="Contact.html">Contact</a>
      <a href="shop.html">Boutique</a>

    </nav>
  </header>
  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Rechercher un objet..." oninput="filterItems()">
  </div>
  <div class="shop-container" id="shop">
    <div class="item-card" data-name="Potion de Soin" data-price="100" data-effect="Restaure 50 PV"
      data-img="https://via.placeholder.com/200x120?text=Potion">
      <img src="https://via.placeholder.com/200x120?text=Potion" alt="Potion">
      <h4>Potion de Soin</h4>
      <p>100 points</p>
      Quantit√© : <span class="item-qty">0</span>
    </div>
    <div class="item-card" data-name="Cape d‚ÄôInvisibilit√©" data-price="300" data-effect="Invisibilit√© pendant 10s"
      data-img="https://via.placeholder.com/200x120?text=Cape">
      <img src="https://via.placeholder.com/200x120?text=Cape" alt="Cape">
      <h4>Cape d‚Äôinvisibilit√©</h4>
      <p>300 points</p>
      Quantit√© : <span class="item-qty">0</span>
    </div>
  </div>

  <div class="overlay" id="productOverlay">
    <div class="product-popup" id="popup">
      <img id="popupImg" src="" alt="Image produit">
      <h3 id="popupName"></h3>
      <p id="popupEffect"></p>
      <p><strong id="popupPrice"></strong> points</p>
      <button class="btn" onclick="buyProduct()">Acheter</button>
    </div>
  </div>

  <audio id="buy-sound" src="https://www.soundjay.com/buttons/sounds/button-09.mp3" preload="auto"></audio>

  <script>

    let userPoints = 5000;
    document.getElementById('points-display').textContent = userPoints.toLocaleString();

    const itemQuantities = {}; // Cl√© = nom du produit, valeur = quantit√© achet√©e

    const overlay = document.getElementById('productOverlay');
    const popupName = document.getElementById('popupName');
    const popupPrice = document.getElementById('popupPrice');
    const popupEffect = document.getElementById('popupEffect');
    const popupImg = document.getElementById('popupImg');
    let currentProduct = null;

    document.querySelectorAll('.item-card').forEach(card => {
      card.addEventListener('click', () => {
        currentProduct = {
          name: card.dataset.name,
          price: card.dataset.price,
          effect: card.dataset.effect,
          img: card.dataset.img
        };
        popupName.textContent = currentProduct.name;
        popupPrice.textContent = currentProduct.price;
        popupEffect.textContent = currentProduct.effect;
        popupImg.src = currentProduct.img;
        overlay.style.display = 'flex';
      });
    });

    function buyProduct() {
      const price = parseInt(currentProduct.price);

      if (userPoints >= price) {
        userPoints -= price;
        document.getElementById('buy-sound').play();
        document.getElementById('buy-sound').play();
        alert(`Vous avez achet√© : ${currentProduct.name} pour ${currentProduct.price} points !`);
        overlay.style.display = 'none';
        // fetch('acheter.php', { method: 'POST', body: JSON.stringify(currentProduct), headers: { 'Content-Type': 'application/json' }});
        alert(`Vous avez achet√© : ${currentProduct.name} pour ${price} points !`);

        // Met √† jour l'affichage des points
        document.getElementById('points-display').textContent = userPoints.toLocaleString();

        // Incr√©mente la quantit√©
        if (!itemQuantities[currentProduct.name]) {
          itemQuantities[currentProduct.name] = 0;
        }
        itemQuantities[currentProduct.name]++;

        // Mets √† jour le champ quantit√© dans la carte
        document.querySelectorAll('.item-card').forEach(card => {
          if (card.dataset.name === currentProduct.name) {
            card.querySelector('.item-qty').textContent = itemQuantities[currentProduct.name];
          }
        });

        overlay.style.display = 'none';
      } else {
        alert("Vous n'avez pas assez de points !");
      }

    }

    overlay.addEventListener('click', e => {
      if (e.target === overlay) {
        overlay.style.display = 'none';
      }
    });

    function filterItems() {
      const query = document.getElementById('searchInput').value.toLowerCase();
      document.querySelectorAll('.item-card').forEach(card => {
        const name = card.dataset.name.toLowerCase();
        card.style.display = name.includes(query) ? '' : 'none';
      });
    }
  </script>
</body>

</html>