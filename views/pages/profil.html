<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profil ‚Äì SoraDrive</title>
    <!-- Google Font Sora -->
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;700&display=swap" rel="stylesheet">
    <!-- Feuille de style externe -->
    <link rel="stylesheet" href="CSSprofil.css">
</head>

<body>
    <div class="container">
        <!-- LEFT -->
        <aside class="sidebar-left">
            <div class="logo">
                <img src="soradrive-logo.svg" alt="SoraDrive">
            </div>
            <nav>
                <ul>
                    <li><a href="#">Pr√©sentation</a></li>
                    <li><a href="#">Trajet</a></li>
                    <li><a href="#" class="active">Profil</a></li>
                    <li><a href="#">Contact</a></li>
                    <li><a href="#">Boutique</a></li>
                </ul>
            </nav>
        </aside>

        <!-- CENTER -->
        <main class="main">
            <!-- Profil Card -->
            <div class="card profile">
                <button class="btn-add">+ Ajouter</button>
                <button class="btn-edit">‚úé</button>

                <!-- 1. Avatar dynamique -->
                <div class="avatar">
                    <img id="avatar" src="" alt="Avatar de l‚Äôutilisateur">
                </div>

                <!-- 2. Rating dynamique -->
                <div id="rating" class="rating"></div>

                <button class="pin">üìå</button>
            </div>

            <!-- Stats Card -->
            <div class="card stats">
                <button class="btn-settings">‚öôÔ∏é</button>

                <!-- 3. Nom complet -->
                <h1 id="fullname">Profil NOM</h1>

                <!-- 4. Score & Streak -->
                <div class="metrics">
                    <div class="metric">
                        ‚úí <span id="score">0</span>
                    </div>
                    <div class="metric">
                        üî• <span id="streak">0</span>
                    </div>
                </div>

                <h2>Quelques chiffres :</h2>
                <!-- 5. Compteurs -->
                <div class="numbers">
                    <span>Conducteur : <strong id="count-driver">0</strong></span>
                    <span>Passager : <strong id="count-passenger">0</strong></span>
                </div>

                <!-- 6. Ic√¥nes bonus -->
                <div class="icons-bottom">
                    <button id="icon-shield">üõ°Ô∏è</button>
                    <button id="icon-car">üöó</button>
                </div>
            </div>
        </main>

        <!-- RIGHT -->
        <aside class="sidebar-right">
            <div class="top-stats">
                <div class="stat">‚úí <span id="score-side">0</span></div>
                <div class="stat">üî• <span id="streak-side">0</span></div>
            </div>

            <div class="friends">
                <h3>Amis</h3>
                <!-- 7. Liste d‚Äôamis -->
                <ul id="friends-list"></ul>
            </div>
        </aside>
    </div>

    <!-- ==== Script d‚Äôint√©gration dynamique ==== -->
    <script>
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                // 1Ô∏è‚É£ R√©cup√©ration des donn√©es du profil
                const profileRes = await fetch('/api/profile');
                const profile = await profileRes.json();
                // Injection des donn√©es de base
                document.getElementById('avatar').src = profile.avatarUrl;
                document.getElementById('avatar').alt = `Avatar de ${profile.fullname}`;
                document.getElementById('fullname').innerText = profile.fullname;

                document.getElementById('score').innerText = profile.score;
                document.getElementById('streak').innerText = profile.streak;
                document.getElementById('score-side').innerText = profile.score;
                document.getElementById('streak-side').innerText = profile.streak;

                document.getElementById('count-driver').innerText = profile.countDriver;
                document.getElementById('count-passenger').innerText = profile.countPassenger;

                // 2Ô∏è‚É£ G√©n√©ration des √©toiles
                const ratingEl = document.getElementById('rating');
                ratingEl.innerHTML = '';
                for (let i = 1; i <= 5; i++) {
                    ratingEl.innerHTML += (i <= profile.rating) ? '‚òÖ' : '‚òÜ';
                }

                // 3Ô∏è‚É£ R√©cup√©ration et affichage de la liste d‚Äôamis
                // Si votre endpoint /api/profile contient d√©j√† friends, vous pouvez utiliser profile.friends
                const friendsRes = await fetch('/api/friends');
                const friends = await friendsRes.json();

                const ul = document.getElementById('friends-list');
                ul.innerHTML = '';
                friends.forEach(f => {
                    const li = document.createElement('li');
                    li.innerHTML = `
            <span class="friend-name">${f.name}</span>
            <div class="actions">
              <button class="btn-friend-settings">‚öôÔ∏é</button>
              <button class="btn-friend-message">üí¨</button>
            </div>
          `;
                    ul.appendChild(li);
                });
            } catch (err) {
                console.error('Erreur chargement profil :', err);
            }
        });
    </script>
</body>

</html>